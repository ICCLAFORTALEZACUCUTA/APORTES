<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <title>Estado de Aportes | ICC</title>
  <style>
    body { font-family: 'Arial', sans-serif; background-color: #f7f7f7; color: #333; margin: 0; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
    h1 { color: #0891b2; border-bottom: 2px solid #34d399; padding-bottom: 10px; margin-bottom: 20px; }
    h2 { color: #0e7490; margin-top: 25px; }
    .info-card { background-color: #e0f2fe; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 5px solid #0891b2; }
    .info-card p { margin: 5px 0; }
    .abono { font-weight: bold; color: #10b981; font-size: 1.1em; }
    .deuda { font-weight: bold; color: #ef4444; font-size: 1.1em; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
    th { background-color: #0e7490; color: white; }
    .pago-ok { color: #10b981; font-weight: bold; }
    .pago-pendiente { color: #ef4444; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Estado de Aportes - <?= participante.nombreCompleto ?></h1>
    
    <div class="info-card">
      <p><strong>Código:</strong> <?= participante.codigo ?></p>
      <p><strong>Tutora:</strong> <?= participante.tutoraID ?></p>
      <p><strong>Abono a Favor:</strong> <span class="abono">$<?= participante.abono.toLocaleString('es-CO') ?></span></p>
    </div>

    <h2>Resumen de Deuda</h2>
    <div class="info-card">
      <p><strong>Último Mes Pagado:</strong> <?= estadoAportes.ultimoMesPago ?></p>
      <p><strong>Meses Pendientes:</strong> <?= estadoAportes.mesesPendientes.length ?> meses</p>
      <p><strong>Total Pendiente a Pagar:</strong> <span class="deuda">$<?= estadoAportes.deudaTotal.toLocaleString('es-CO') ?></span></p>
    </div>
    
    <h2>Cuadro de Pagos Histórico (Ene 2022 - Actualidad)</h2>
    <table>
      <thead>
        <tr>
          <th>Año</th>
          <th>Ene</th><th>Feb</th><th>Mar</th><th>Abr</th><th>May</th><th>Jun</th>
          <th>Jul</th><th>Ago</th><th>Sep</th><th>Oct</th><th>Nov</th><th>Dic</th>
        </tr>
      </thead>
      <tbody>
        <? const meses = ['01','02','03','04','05','06','07','08','09','10','11','12']; ?>
        <? 
          // Agrupación por año
          const historialPorAnio = estadoAportes.mesesHistoricos.reduce((acc, mes) => {
            if (!acc[mes.anio]) acc[mes.anio] = {};
            acc[mes.anio][mes.mesAnio.split('/')[0]] = mes.pagado;
            return acc;
          }, {});
        ?>
        <? for (let anio in historialPorAnio) { ?>
          <tr>
            <td><strong><?= anio ?></strong></td>
            <? meses.forEach(mesNum => { ?>
              <? const pagado = historialPorAnio[anio][mesNum]; ?>
              <td class="<?= pagado ? 'pago-ok' : 'pago-pendiente' ?>">
                <?= pagado ? '✅' : '❌' ?>
              </td>
            <? }); ?>
          </tr>
        <? } ?>
      </tbody>
    </table>

    <h2>Historial de Transacciones</h2>
    <? if (historialPagos.length > 0) { ?>
      <table>
        <thead>
          <tr><th>Fecha Registro</th><th>Mes Cubierto</th><th>Monto Total Pagado</th><th>Registrador</th></tr>
        </thead>
        <tbody>
          <? historialPagos.forEach(pago => { ?>
            <tr>
              <td><?= pago.fecha ?></td>
              <td><?= pago.mesCubierto ?></td>
              <td>$<?= pago.montoPagado.toLocaleString('es-CO') ?></td>
              <td><?= pago.registrador ?></td>
            </tr>
          <? }); ?>
        </tbody>
      </table>
    <? } else { ?>
      <p>Aún no hay transacciones registradas para este participante.</p>
    <? } ?>
  </div>
</body>
</html>
